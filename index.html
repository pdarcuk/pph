<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PigpenÂ +Â CaesarÂ DecoderÂ Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- TailwindÂ (viaÂ CDN so you donâ€™t need any build tools) -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body{font-family:"Courier New",monospace}
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-700 to-indigo-900 text-white min-h-screen flex flex-col items-center">
  <h1 class="text-4xl font-bold mt-6">PigpenÂ +Â CaesarÂ DecoderÂ Lab</h1>
  <p class="mt-2 text-lg text-center max-w-xl px-2">This page lets you practise cracking Pigpen ciphers. <strong>StepÂ 1</strong>Â â€“ convert each symbol to its letter using the Pigpen chart. <strong>StepÂ 2</strong>Â â€“ use the Caesarâ€‘shift tools below to reveal the message.</p>

  <div class="w-full max-w-3xl mt-10 px-4">
    <!-- INPUT -->
    <label class="block mb-2 font-semibold">StepÂ 1 â€“ Paste the letters you got from Pigpen:</label>
    <textarea id="cipher" rows="3" class="w-full p-3 rounded-lg text-gray-900" placeholder="e.g. FRQJUDWV!"></textarea>

    <!-- CONTROLS -->
    <div class="mt-6 flex flex-col sm:flex-row sm:items-center sm:space-x-6">
      <div class="flex-1">
        <label class="block mb-2 font-semibold">StepÂ 2 â€“ Choose shift (<span id="shiftValue">0</span>)</label>
        <input id="shift" type="range" min="0" max="25" value="0" class="w-full">
      </div>
      <button id="decodeBtn" class="mt-6 sm:mt-0 bg-emerald-400 hover:bg-emerald-500 text-black font-bold py-3 px-6 rounded-xl shadow-lg transition-all">DecodeÂ âžœ</button>
    </div>

    <!-- OUTPUT -->
    <div class="mt-8">
      <label class="block mb-2 font-semibold">Output:</label>
      <textarea id="output" rows="3" class="w-full p-3 rounded-lg text-gray-900" readonly></textarea>
    </div>

    <!-- FREQUENCY ANALYSIS -->
    <div class="mt-10">
      <h2 class="text-2xl font-bold mb-2">Need a hint?</h2>
      <button id="freqBtn" class="bg-pink-300 hover:bg-pink-400 text-black font-semibold py-2 px-4 rounded-lg shadow">Run frequency analysis</button>
      <pre id="freqResults" class="mt-4 whitespace-pre-wrap"></pre>
    </div>
  </div>

  <script>
    const inputEl = document.getElementById('cipher');
    const shiftEl = document.getElementById('shift');
    const shiftValue = document.getElementById('shiftValue');
    const outputEl = document.getElementById('output');
    const decodeBtn = document.getElementById('decodeBtn');
    const freqBtn = document.getElementById('freqBtn');
    const freqResults = document.getElementById('freqResults');

    function caesarDecode(text, shift) {
      const A = 'A'.charCodeAt(0);
      return [...text.toUpperCase()].map(ch => {
        const code = ch.charCodeAt(0);
        if (code >= 65 && code <= 90) {
          const pos = (code - A - shift + 26) % 26;
          return String.fromCharCode(A + pos);
        }
        return ch; // keep punctuation & spaces
      }).join('');
    }

    function doDecode() {
      const shift = parseInt(shiftEl.value, 10);
      outputEl.value = caesarDecode(inputEl.value, shift);
    }

    function frequency(text) {
      const counts = Array(26).fill(0);
      [...text.toUpperCase()].forEach(ch => {
        const code = ch.charCodeAt(0);
        if (code >= 65 && code <= 90) counts[code - 65]++;
      });
      return counts;
    }

    function showFreq() {
      const counts = frequency(inputEl.value);
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
      const pairs = letters.map((l,i)=>({l, count: counts[i]}));
      pairs.sort((a,b)=>b.count-a.count);
      const most = pairs[0];
      let guessShift = null;
      if (most.count > 0) {
        const assumedEIndex = 'E'.charCodeAt(0) - 65;
        guessShift = (most.l.charCodeAt(0) - 65 - assumedEIndex + 26) % 26;
      }
      let lines = pairs.filter(p=>p.count>0).map(p=>`${p.l}: ${p.count}`).join('\n');
      if (guessShift !== null) {
        lines += `\n\nðŸ¤–Â My best guess: try shift ${guessShift}`;
      }
      freqResults.textContent = lines || 'No letters to analyse yet!';
    }

    // hook up events
    shiftEl.addEventListener('input', () => {
      shiftValue.textContent = shiftEl.value;
      doDecode(); // live preview
    });
    decodeBtn.addEventListener('click', doDecode);
    freqBtn.addEventListener('click', showFreq);
  </script>
</body>
</html>
